

<!doctype html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <title>Googol - Motor de Pesquisa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        .google-letter {
            font-weight: 700;
            display: inline-block;
            font-size: 1.8rem;
        }

        :root {
            --bg-gradient: linear-gradient(135deg, #1b1b1b, #1c1c1c, #171717);
            --glass-bg: rgba(34, 34, 34, 0.8);
            --accent: #22c55e;
            --accent-soft: rgba(34, 197, 94, 0.15);
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --border-subtle: rgba(148, 163, 184, 0.3);
            --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.9);
            --radius-xl: 18px;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        .page-shell {
            width: 100%;
            max-width: 1240px;
            padding: 32px 16px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 992px) {
            .page-shell { padding: 40px 24px; }
        }

        .top-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            background-image: url("/img/logo_bw_circular.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .brand-text-main {
            font-weight: 700;
            letter-spacing: 0.08em;
            font-size: 1.1rem;
            min-width: 7ch;
        }

        .brand-text-sub {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .top-nav-right {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .badge-pill {
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            padding: 4px 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .badge-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
        }

        .main-layout {
            display: grid;
            grid-template-columns: minmax(0, 2.4fr) minmax(0, 1fr);
            gap: 20px;
            align-items: flex-start;
        }

        @media (max-width: 991px) {
            .main-layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .search-panel {
            background: var(--glass-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(148, 163, 184, 0.28);
            padding: 22px;
            backdrop-filter: blur(22px);
        }

        .search-header { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
        .search-title { display: flex; justify-content: space-between; align-items: center; }
        .search-title h1 { font-size: 1.1rem; margin: 0; font-weight: 600; }
        .search-subtitle { font-size: 0.8rem; color: var(--text-muted); }

        .search-chip-row { display: flex; flex-wrap: wrap; gap: 6px; font-size: 0.7rem; }
        .search-chip {
            padding: 4px 10px;
            border-radius: 999px;
            background-color: rgba(148, 163, 184, 0.12);
            color: var(--text-muted);
        }

        .search-main { margin-top: 4px; margin-bottom: 8px; }
        .search-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 999px;
            padding: 4px 6px 4px 14px;
            border: 1px solid rgba(148, 163, 184, 0.45);
            background-color: rgba(15, 23, 42, 0.9);
        }

        .search-input { flex: 1; border: none; outline: none; background: transparent; color: var(--text-main); }
        .search-input::placeholder { color: #6b7280; }

        .search-button-main {
            border-radius: 999px;
            border: none;
            padding: 8px 18px;
            font-size: 0.85rem;
            font-weight: 500;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #020617;
            display: inline-flex;
            gap: 6px;
            transition: transform 0.08s ease;
        }

        .search-button-main:hover { transform: translateY(-1px); box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35); }

        .btn-ghost {
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 0.75rem;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background-color: rgba(15, 23, 42, 0.9);
            color: var(--text-muted);
            display: inline-flex;
            gap: 6px;
        }

        .btn-ghost .dot { width: 8px; height: 8px; border-radius: 999px; }
        .btn-ghost .dot { background: #f97316; }
        .btn-ghost.ai .dot { background: #38bdf8; }

        .result-card {
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid rgba(30, 64, 175, 0.45);
            background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.05), rgba(15,23,42,1));
        }

        .result-card:hover {
            border-color: rgba(56,189,248,0.9);
            transform: translateY(-1px);
        }

        .side-card {
            background: rgba(15,23,42,0.75);
            border-radius: 16px;
            border: 1px solid rgba(148,163,184,0.26);
            padding: 14px;
            backdrop-filter: blur(18px);
        }
    </style>
</head>

<!-- Som da máquina de escrever -->
<audio id="typeSound" src="/sounds/type.mp3" preload="auto"></audio>

<body>
<div class="page-shell">

    <!-- Top bar -->
    <header class="top-nav">
        <div class="brand">
            <div class="brand-logo"></div>
            <div>
                <div class="brand-text-main" id="brand-typing"></div>
                <div class="brand-text-sub">Distributed search · Meta 2</div>
            </div>
        </div>
        <div class="top-nav-right">
            <div class="badge-pill">
                <span class="badge-dot"></span><span>Cluster online</span>
            </div>
            <span>SD · 2025/26</span>
        </div>
    </header>

    <!-- GRID -->
    <main class="main-layout">

        <!-- SEARCH PANEL -->
        <section class="search-panel">

            <div class="search-header">
                <div class="search-title">
                    <h1>Explora a web indexada pelo teu cluster</h1>
                    <span class="search-subtitle d-none d-md-inline">Gateway · Barrels · Downloaders em tempo real</span>
                </div>

                <div class="search-chip-row">
                    <span class="search-chip">Multicast fiável</span>
                    <span class="search-chip">Índice invertido</span>
                    <span class="search-chip">RMI · Java</span>
                    <span class="search-chip">Meta 2</span>
                </div>
            </div>

            <!-- SEARCH BOX -->
            <div class="search-main">
                <form method="get" action="/search" class="d-flex align-items-center gap-2">
                    <div class="search-input-wrapper">
                        <span class="search-icon">⌕</span>
                        <input type="text" class="search-input" name="q" placeholder="O que queres procurar?" required>
                    </div>
                    <button type="submit" class="search-button-main">
                        <span class="icon">↵</span><span>Pesquisar</span>
                    </button>
                </form>

                <div class="search-actions">
                    <form method="post" action="/search/hacker-news">
                        <button class="btn-ghost"><span class="dot"></span>Indexar top stories do Hacker News</button>
                    </form>

                    <form method="post" action="/search/analysis">
                        <button class="btn-ghost ai"><span class="dot"></span>Análise da pesquisa com IA</button>
                    </form>
                </div>
            </div>

            <hr class="divider-soft">

            <!-- INDEX URL -->
            <section>
                <form class="row g-2 align-items-center" method="post" action="/index">
                    <div class="col-md-9">
                        <input type="url" class="form-control form-control-sm"
                               name="url" placeholder="Adicionar novo URL ao sistema (https://...)"
                               required
                               style="background-color: rgba(15,23,42,0.9);
                                      border-color: rgba(148,163,184,0.5);
                                      color: var(--text-main);">
                    </div>
                    <div class="col-md-3 d-grid">
                        <button type="submit" class="btn btn-sm btn-outline-success">Adicionar à fila</button>
                    </div>
                </form>
            </section>

            <hr class="divider-soft">

            <!-- RESULTS -->
            <section>
                <div class="results-count" th:if="${totalResults != null}"
                     th:text="${totalResults} + ' resultados encontrados'">
                    Não há resultados ainda.
                </div>

                <div class="results-list" th:if="${results != null}">
                    <a class="result-card text-decoration-none"
                       th:each="r : ${results}" th:href="${r.url}">
                        <div class="result-title-row">
                            <h2 class="result-title" th:text="${r.title}"></h2>
                            <span class="result-score" th:text="'Score: ' + ${r.relevance}">Score: 0</span>
                        </div>
                        <div class="result-url" th:text="${r.url}"></div>
                        <p class="result-snippet" th:text="${r.snippet}"></p>
                        <div class="result-meta">
                            <span>Servido a partir de Barrels distribuídos</span>
                        </div>
                    </a>
                </div>

                <div class="mt-3" th:if="${aiAnalysis != null}">
                    <div class="search-subtitle mb-1">Análise da pesquisa</div>
                    <p style="font-size: 0.82rem; color: var(--text-muted);" th:text="${aiAnalysis}"></p>
                </div>
            </section>
        </section>

        <!-- SIDE PANEL -->
        <aside class="side-panel">
            <section class="side-card">
                <div class="side-title">Estado do cluster</div>
                <ul class="side-list">
                    <li>Downloaders ativos: <span id="stats-downloaders">-</span></li>
                    <li>Barrels ativos: <span id="stats-barrels">-</span></li>
                    <li>URLs na fila: <span id="stats-queue-size">-</span></li>
                </ul>
                <div class="side-footer">Atualizado em tempo real via WebSocket.</div>
            </section>

            <section class="side-card">
                <div class="side-title">Top 10 pesquisas</div>
                <ol class="side-list" id="stats-top-queries"></ol>
            </section>

            <section class="side-card">
                <div class="side-title">Latência dos Barrels</div>
                <ul class="side-list" id="stats-latencies"></ul>
            </section>
        </aside>

    </main>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- WebSocket stats -->
<script>
(function () {
    let socket = new SockJS('/ws-stats');
    let stompClient = Stomp.over(socket);
    stompClient.debug = null;

    stompClient.connect({}, function () {
        stompClient.subscribe('/topic/stats', function (message) {
            const data = JSON.parse(message.body);

            document.getElementById('stats-downloaders').textContent = data.downloadersActive;
            document.getElementById('stats-barrels').textContent = data.barrelsActive;
            document.getElementById('stats-queue-size').textContent = data.queueSize;

            const topQueriesElem = document.getElementById('stats-top-queries');
            topQueriesElem.innerHTML = '';
            (data.topQueries || []).forEach(q => {
                const li = document.createElement('li');
                li.textContent = q;
                topQueriesElem.appendChild(li);
            });

            const latenciesElem = document.getElementById('stats-latencies');
            latenciesElem.innerHTML = '';
            (data.barrelLatencies || []).forEach(b => {
                const li = document.createElement('li');
                li.textContent = b.barrelId + ': ' + b.avgMs + ' ms';
                latenciesElem.appendChild(li);
            });
        });
    });
})();
</script>

<!-- Animated Google/Googol with sound -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const container = document.getElementById("brand-typing");
    const sound = document.getElementById("typeSound");

    const firstWord = "Google";
    const secondWord = "Googol";

    const googleColors = [
        "#4285F4", "#EA4335", "#FBBC05",
        "#4285F4", "#34A853", "#EA4335"
    ];

    const typeDelay = 180;
    const deleteDelay = 110;

    function playSound() {
        if (sound) {
            sound.currentTime = 0;
            sound.play();
        }
    }

    function typeWord(word, done) {
        container.innerHTML = "";
        let index = 0;

        function typeNext() {
            if (index < word.length) {
                const span = document.createElement("span");
                span.textContent = word[index];
                span.classList.add("google-letter");
                span.style.color = googleColors[index % googleColors.length];

                container.appendChild(span);
                playSound();

                index++;
                setTimeout(typeNext, typeDelay);
            } else {
                setTimeout(done, 600);
            }
        }
        typeNext();
    }

    function deleteWord(done) {
        let letters = container.children;

        function deleteNext() {
            if (letters.length > 0) {
                letters[letters.length - 1].remove();
                playSound();
                setTimeout(deleteNext, deleteDelay);
            } else {
                setTimeout(done, 300);
            }
        }
        deleteNext();
    }

    typeWord(firstWord, () => {
        deleteWord(() => {
            typeWord(secondWord, () => {});
        });
    });
});
</script>

</body>
</html>
